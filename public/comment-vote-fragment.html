<link rel="import" href="components/polymer/polymer.html">
<link rel="import" href="components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="components/iron-icons/iron-icons.html">
<link rel="import" href="shared-styles.html">

<dom-module id="comment-vote-fragment">
    <template>
        <style include="shared-styles"></style>
        <style>
            :host {                
                display: flex;
                flex-direction: column;
                padding-right:10px;
            }
            paper-icon-button{
                padding:0;
                height:22px;
                width:22px;
            }
            #up.active{
                color:var(--vote-up);
            }
            #down.active{
                color:var(--vote-down);
            }
        </style>
        
        <paper-icon-button 
            class$="[[voteUpStatus]]" 
            id="up" 
            icon="arrow-drop-up" 
            on-tap="voteUp"></paper-icon-button>
            
        <paper-icon-button 
            class$="[[voteDownStatus]]"
            id="down" 
            icon="arrow-drop-down" 
            on-tap="voteDown"></paper-icon-button>
    </template>
    <script>
        Polymer({
            is: 'comment-vote-fragment',
            properties: {
                comment: {
                    type: Object,
                    notify: true
                },
                user: {
                    type: Object
                },
                vote:{
                    type: Number,
                    computed: "_getVote(comment, user)"
                },
                voteUpStatus:{
                    type: String,
                    computed: "_getStatus(1, vote)"
                },
                voteDownStatus:{
                    type: String,
                    computed: "_getStatus(-1, vote)"
                }

            },
            _getStatus(key, vote){
                if(key == vote){
                    return active;
                }else{
                    return ""
                }
            },
            _getVote(comment, user){
                return comment.votes && comment.votes[this.user.uid] ? comment.votes[this.user.uid] : 0;
            },
            voteDown(){
                this.cast(-1);
            },
            voteUp(){
                this.cast(1);
            },
            cast(vote){
                if(!this.comment.votes) {
                    this.comment.votes = {};
                }

                if(this.comment.votes[this.user.uid] === vote) {
                    this.comment.votes[this.user.uid] = 0;
                } else {
                    this.comment.votes[this.user.uid] = vote;
                }
                
                if(!this.comment.total) {
                    this.comment["total"] = 0;
                }

                this.comment.total += this.comment.votes[this.user.uid];
            }
        });
    </script>
</dom-module>
