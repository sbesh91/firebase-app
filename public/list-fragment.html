<link rel="import" href="components/polymer/polymer.html">
<link rel="import" href="components/neon-animation/neon-shared-element-animatable-behavior.html">
<link rel="import" href="components/neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="components/neon-animation/neon-animatable-behavior.html">
<link rel="import" href="components/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="components/iron-icons/iron-icons.html">
<link rel="import" href="custom-hero-animation.html">

<dom-module id="list-fragment">
    <template>
        <style>
            :host {
                display: block;
            }
            .content {
                display: flex;
                justify-content: space-between;
                position:relative;
                padding: 5px 10px;
                border-top: 1px solid var(--border-color);                
            }
        </style>        

        <template 
            is="dom-repeat" 
            items={{posts}} 
            as="post"
            initialCount="3">            
            <!--make a post component to handle stateful changes-->
            <div class="content" id="[[post.$key]]">
                <div>                
                    <div>[[post.title]]</div>
                </div>            
                <paper-icon-button 
                    data-key$="[[post.$key]]"
                    on-tap="select"
                    id="expand" 
                    icon="icons:fullscreen"
                    ></paper-icon-button>
            </div>            
        </template>
    </template>
    <script>
        Polymer({
            is: 'list-fragment',
            behaviors: [
                Polymer.NeonSharedElementAnimatableBehavior,
                Polymer.NeonAnimationRunnerBehavior,
                Polymer.NeonAnimatableBehavior
            ],
            properties: {
                posts: {
                    type: Array
                },                       
                postPath: {
                    type: String,
                    notify: true                    
                },                       
                hash: {
                    type: String          
                },
                animationConfig: {
                    value: function() {
                        return {
                            'entry': [
                                {
                                    name:"fade-in-animation",
                                    node:this,
                                    timing:{
                                        duration:400
                                    }
                                }
                            ],
                            'exit': [
                                {
                                    name: 'custom-hero-animation',
                                    id: 'hero-back',
                                    fromPage: this
                                },                       
                            ]
                        }
                    }
                },
                sharedElements: {
                    value: function() {
                        return {                            
                            'hero-back': this
                        }
                    }
                }
            },            
            select(event){              
                let target = event.target;
                if(event.target.id === "icon")                          
                {
                    target = event.target.parentElement;
                }
                this.sharedElements = {
                    'hero-back': this.$$(`#${target.dataset.key}`)
                }
                this.postPath = `/posts/${target.dataset.key}`;
            }
        });
    </script>
</dom-module>
