<link rel="import" href="components/polymer/polymer.html">
<link rel="import" href="components/polymerfire/firebase-document.html">
<link rel="import" href="components/neon-animation/neon-animated-pages.html">
<link rel="import" href="mini-post-fragment.html">
<link rel="import" href="max-post-fragment.html">
<link rel="import" href="shared-styles.html">

<dom-module id="post-fragment">
    <template>
        <style include="shared-styles"></style>
        <style>
            :host {                
                display: block; 
                height:50px;
            }                        
        </style>                 
         <iron-location 
            path="{{path}}"
            hash="{{hash}}">
        </iron-location>

        <firebase-document
            path="{{postPath}}"
            data="{{thisPost}}">
        </firebase-document>           
                
        <neon-animated-pages 
            id="pages"
            selected="[[selected]]">            
            <mini-post-fragment 
                on-tap="select"
                post="[[post]]">
            </mini-post-fragment>       

            <max-post-fragment 
                on-tap="home"
                post="[[post]]">
            </max-post-fragment>            
        </neon-animated-pages>                    
    </template>
    <script>
        Polymer({
            is: 'post-fragment',
            properties:{
                post: {
                    type: Object
                },
                thisPost:{
                    type: Object
                },
                postPath: {
                    type: String
                },
                isExpanded: {
                    type: Boolean,
                    value: false                    
                },
                path:{
                    type: String
                },
                hash:{
                    type: String
                },                
                selected:{
                    type: Number,
                    computed:"_computeLocation(isExpanded)"
                }
            },        
            attached(){
                if(this.post && `/posts/${this.post.$key}` === this.hash){
                    this.isExpanded = true;
                }
            },    
            _computeLocation(isExpanded){
                if(isExpanded){
                    document.querySelector("body").style["overflow"] = "hidden";
                    return 1;
                } else {
                    document.querySelector("body").style["overflow"] = "";
                    return 0;
                }
            },
            select(){
                this.postPath = `/posts/${this.post.$key}`;
                this.hash = this.postPath;
                this.isExpanded = true;
            },
            home(){
                this.postPath = "";
                this.hash = "";
                this.isExpanded = false;
            }
        });
    </script>
</dom-module>
